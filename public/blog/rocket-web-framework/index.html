<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="referrer" content="no-referrer">

        <link rel="stylesheet" href="http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;fonts.css">
        <link rel="stylesheet" href="http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;style.css">

        <title>
    Building a simple REST API with the Rocket Web Framework
</title>

        
    </head>
    <body>
        
    <div class="wrap">
        <div class="section" id="title">
            
    Building a simple REST API with the Rocket Web Framework

        </div>
        <div class="section" id="content">
            
    
        
            
    
    Sun Mar 29, 2020

        
        
            
                &#183; 1019 words
            
        
        
            
            
                &#183; 6 min
            
        
        
        <hr/>
    
    <h1 id="building-a-simple-rest-api-with-the-rocket-web-framework">Building a simple REST API with the Rocket Web Framework</h1>
<h2 id="introduction">Introduction</h2>
<p>Rocket is a web framework written in and designed to be used for the Rust programming language. It has many similarities to web frameworks in other languages, like Flask, Rails, Node.js, and others. Rocket makes it easy to create a simple web server application, while keeping the guaranteed memory safety and security of the Rust language. It abstracts some web server details about routing and HTTP away from the user so that you can get an application up and running quickly. In this post, I am going to show you how to create a simple request/response server that you can interact with through your web browser. Let's begin!</p>
<h2 id="create-a-new-rust-project">Create a new Rust project</h2>
<p>First, we need to create a new Rust project. The project will be named 'basic-web'. Navigate the directory where you want the project to be and enter the following two commands in your terminal:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">cargo new basic-web --bin</span><span style="color:#c0c5ce;">
cd basic-web</span><span style="color:#c0c5ce;">
</span></pre>
<p>Next, add the following dependency to the Cargo.toml file in the root of the project directory:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">[dependencies]</span><span style="color:#c0c5ce;">
</span><span style="color:#bf616a;">rocket </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">0.4.4</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span></pre>
<p>Rocket requires the nightly version of Rust, which contains more experimental features, so we are going to set it up so that the nightly version is only used on this specific project. Enter the following command in the terminal to do so:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">rustup override set nightly</span><span style="color:#c0c5ce;">
</span></pre>
<p>Once Rust nightly finishes installing, we can start writing the web server!</p>
<h2 id="routes-and-requests">Routes and Requests</h2>
<p>Rocket accepts requests by matching the route requested by the client application to the request handler with the matching route. In the main.rs file, copy the following code in:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">get</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/hello</span><span style="color:#c0c5ce;">&quot;)]              </span><span style="color:#65737e;">// route attribute</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">world</span><span style="color:#c0c5ce;">() -&gt; &amp;</span><span style="color:#b48ead;">&#39;static str </span><span style="color:#c0c5ce;">{  </span><span style="color:#65737e;">// request handler function</span><span style="color:#c0c5ce;">
    &quot;</span><span style="color:#a3be8c;">hello, world!</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span></pre>
<p>The line <code>#[get(&quot;/hello&quot;)]</code> defines a route that will be invoked on any HTTP GET request to <code>http://localhost:8000/hello</code>. It must be that exact URL, or the server will return an HTTP 404 response.
The function defined will return &quot;hello world&quot; to the client in the response when the request is received.</p>
<p>To make the route handler a little more interesting, change it so that it looks like the following:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">#[</span><span style="color:#bf616a;">get</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/hello/&lt;name&gt;</span><span style="color:#c0c5ce;">&quot;)]</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">hello</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">name</span><span style="color:#c0c5ce;">: &amp;RawStr) -&gt; String {</span><span style="color:#c0c5ce;">
    format!(&quot;</span><span style="color:#a3be8c;">Hello, </span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">!</span><span style="color:#c0c5ce;">&quot;, name.</span><span style="color:#96b5b4;">as_str</span><span style="color:#c0c5ce;">())</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span></pre>
<p>Now, the route has a dynamic path. The angle brackets in <code>&quot;/hello/&lt;name&gt;&quot;</code> mean that any string you place inside of that path on the client will be extracted and passed into the request handler function. In this case, we are displaying the passed in string next to the word &quot;Hello&quot;. So the response will change based on the URL path! Once the server is running you will be able to see how it works.</p>
<h2 id="serving-a-file">Serving a file</h2>
<p>To make the server more realistic, we are going to add a route handler that will serve an image file from the server, to the client. 
First, place any kind of image file into a directory named <code>static</code>. This directory must be at the root of the project.
Next, add the following function to the main.rs file:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">use </span><span style="color:#c0c5ce;">rocket::response::NamedFile;</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">use </span><span style="color:#c0c5ce;">std::path::{PathBuf, Path};</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
#[</span><span style="color:#bf616a;">get</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/&lt;file..&gt;</span><span style="color:#c0c5ce;">&quot;)]</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">files</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">file</span><span style="color:#c0c5ce;">: PathBuf) -&gt; Option&lt;NamedFile&gt; {</span><span style="color:#c0c5ce;">
    NamedFile::open(Path::new(&quot;</span><span style="color:#a3be8c;">static/</span><span style="color:#c0c5ce;">&quot;).</span><span style="color:#96b5b4;">join</span><span style="color:#c0c5ce;">(file)).</span><span style="color:#96b5b4;">ok</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span></pre>
<p>The first two lines are some necessary import statements. The function <code>files</code> will serve a static file hosted in the 'static' folder on the server. The route handler will match any URL at the index of the server, with any file name added on. For example, this URL will serve the file <code>ferris.jpg</code> and display it in the browser: <code>http://localhost:8000/ferris.jpg</code>.</p>
<p>The server can now serve text and files, let's get it mounted and running!</p>
<h2 id="mounting">Mounting</h2>
<p>The last thing that needs to happen in order for the web application to function is the request routes need to be mounted to the paths created by Rocket.
Copy the following code into the main.rs file, replacing the main function that was in there:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">() {</span><span style="color:#c0c5ce;">
    rocket::ignite().</span><span style="color:#96b5b4;">mount</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/</span><span style="color:#c0c5ce;">&quot;, routes![files])</span><span style="color:#c0c5ce;">
                    .</span><span style="color:#96b5b4;">mount</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/hello</span><span style="color:#c0c5ce;">&quot;, routes![world])</span><span style="color:#c0c5ce;">
                    .</span><span style="color:#96b5b4;">launch</span><span style="color:#c0c5ce;">();</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span></pre>
<p>This code will create an new instance of Rocket with <code>ignite()</code>, and mount all of the routes in the supplied Vector at the given base path. The Vector is the <code>routes![world]</code> part, which accepts any number of route handling function. We are matching two different routes, the base path of the server at <code>/</code>, and the path at <code>/hello</code>. <code>/</code> will be used to serve the image, and <code>/hello</code> will be used to serve a text response. 
The <code>launch()</code> function will start the Rocket application server and begin listening for and dispatching requests to the mounted routes.</p>
<p>Finally, add these lines to the main.rs file:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">#![</span><span style="color:#bf616a;">feature</span><span style="color:#c0c5ce;">(proc_macro_hygiene, decl_macro)]</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">use </span><span style="color:#c0c5ce;">rocket::response::NamedFile;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
#[</span><span style="color:#bf616a;">macro_use</span><span style="color:#c0c5ce;">]</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">extern crate</span><span style="color:#c0c5ce;"> rocket;</span><span style="color:#c0c5ce;">
</span></pre>
<p>The <code>#![feature]</code> line tells Rust to use feature from the Nightly version of Rust.
The <code>extern crate rocket</code> imports the Rocket crate and all of it's macros that are needed to run the server. </p>
<h2 id="starting-the-server">Starting the server</h2>
<p>Now we can start the server! Start the application by typing <code>cargo run</code> into the terminal, and you should see something similar to this:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">🔧  Configured for development.</span><span style="color:#c0c5ce;">
    =&gt; address: localhost</span><span style="color:#c0c5ce;">
    =&gt; port: 8000</span><span style="color:#c0c5ce;">
    =&gt; log: normal</span><span style="color:#c0c5ce;">
    =&gt; workers: [logical cores * 2]</span><span style="color:#c0c5ce;">
    =&gt; secret key: generated</span><span style="color:#c0c5ce;">
    =&gt; limits: forms = 32KiB</span><span style="color:#c0c5ce;">
    =&gt; keep-alive: 5s</span><span style="color:#c0c5ce;">
    =&gt; tls: disabled</span><span style="color:#c0c5ce;">
🛰  Mounting &#39;/hello&#39;:</span><span style="color:#c0c5ce;">
    =&gt; GET /hello/world (world)</span><span style="color:#c0c5ce;">
🚀  Rocket has launched from http://localhost:8000</span><span style="color:#c0c5ce;">
</span></pre>
<p>You can now visit <code>http://localhost:8000/&lt;name&gt;</code>, where <code>&lt;name&gt;</code> is any name, and the browser should display <code>Hello &lt;name&gt;</code>. 
Visit <code>http://localhost:8000/&lt;image&gt;</code> where <image> is the file name of the image in the <code>static</code> folder. The image should display in the browser, like so:</p>
<p><img src="/images/screen.png" alt="screenshot" title="Image being served from localhost:8000/ferris.gif" /></p>
<h2 id="conclusion">Conclusion</h2>
<p>Other things that could be implemented in the server are:</p>
<ul>
<li>Streams: Rocket can stream a response to the client (for things such as videos)</li>
<li>Serializing responses into JSON and other types</li>
<li>Error handling, with custom responders for 400 and 500 status codes</li>
<li>And much more...</li>
</ul>
<p>Thank you for reading!</p>
<h4 id="see-more-at-the-official-rocket-homepage">See more at the <a href="https://rocket.rs/">Official Rocket homepage</a></h4>
<p><img src="/images/dancing-ferris.gif" alt="Ferris" title="Ferris the crab" /></p>
<h3 id="always-be-rusty">Always be rusty!</h3>


        </div>
        
    <div class="section bottom-menu">
        <hr/>
        <p>
            
                
                    <a href="&#x2F;blog">Calder&#x27;s blog</a>
                    &#183;
                
            
            <a href="http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;">
                home
            </a>
        </p>
    </div>

        
    

    </div>

    <script src="/livereload.js?port=1000&mindelay=10"></script></body>
</html>
